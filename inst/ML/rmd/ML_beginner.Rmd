---
title: "Title of your Descriptive Analyses"
date: \today
output:
  html_document:
    toc: yes
    toc_depth: 3
    number_sections: yes
    #code_folding: hide
editor_options:
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(out.width = "80%")
```

```{r echo=FALSE}
library(KhelpeR)
```

# Data Loading

```{r}
# specify variables here
dir_input <- "./data/"
filename_train <- "train.csv"
filename_test <- "test.csv"
```

```{r}
data_train <- data.table::fread(
  file = paste0(dir_input, filename_train),
  header = T,
  stringsAsFactors = F
)

data_test <- data.table::fread(
  file = paste0(dir_input, filename_test),
  header = T,
  stringsAsFactors = F
)
rm(dir_input, filename_train, filename_test)
```

# Getting First Data Overview 

## Train Data

Legend:
- Neg: number of negative values
- Pos: number of positive values
- OutLo: Number of outliers (records below Q25-1.5*IQR, where IQR=Q75-Q25)
- OutHi: Number of outliers (records above Q75+1.5*IQR, where IQR=Q75-Q25)

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(data_train, method = "base")
)
```

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(data_train, method = "others")
)
```

## Test Data

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(data_test, method = "base")
)
```

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(data_test, method = "others")
)
```

# Identify and Define ID_COL and TARGET_COL

```{r}
ID_COL <- ("YOUR_ID_CODE_HERE")
TARGET_COL <- ("YOUR_TARGET_ID_HERE")
OBJECTIVE <- ("classification" or "regression")
```

# Data Preprocessing

## Combine Data

```{r}
# add type col to train_data
data_train[, type := "train"]

# add target col + type to test_data
data_test[, (TARGET_COL) := NA][
  , type := "test"
]
```

```{r}
# merge datasets for uniform preprocessing
dataset <- data.table::rbindlist(
  list(
    data_train,
    data_test
  )
)
rm(data_train, data_test)
invisible(gc())
```

## Check and Set Variable Types

### Target Variable

```{r}
# Define Variable types
dataset[, (ID_COL) := as.character(get(ID_COL))][
  , type := as.character(type)
][
  , (TARGET_COL) := ifelse(
    OBJECTIVE == "classification",
    factor(get(TARGET_COL)),
    ifelse(OBJECTIVE == "regression",
           as.numeric(as.character(get(TARGET_COL))),
           stop(paste0("OBJECTIVE must be one ",
           "of 'classification' or 'regression'"))
    )
  )
]
```

### Set Factor Variables 

```{r}
# factors
#vec_cat <- colnames(dataset)[c()]
#dataset[,(vec_cat):=lapply(.SD, as.factor), .SDcols=vec_cat]
```

### Set Numeric Variables

```{r}
# numeric
vec_num <- colnames(dataset)[colnames(dataset) %notin% c(ID_COL, TARGET_COL, "type")]
# dataset[,(vec_num):=lapply(.SD, function(x){as.numeric(as.character(x))}), .SDcols=vec_num]
```

# Descriptive Analysis 

## Overview Trainings Set 

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(dataset[get("type") == "train",], method = "base")
)
```

## Overview Test Set

```{r}
KhelpeR::kable_table(
  KhelpeR::stats_table(dataset[get("type") == "test",], method = "base")
)
```

## Analyze ID_COL

Count of duplicated IDs

```{r}
sum(duplicated(dataset[type == "train", get(ID_COL)]))
```

## Analyze TARGET_COL

```{r}
summarytools::freq(dataset[type=="train",get(TARGET_COL)])
```

## Missings Treatment

## Categorical Variables Treatment 

# Write Options File

```{r}
# generate empty _options.R file
suppressMessages(suppressWarnings(file.create("options.R")))

# write vec_num
if (!is.null(vec_num)) {
  out.vec_num <- paste0("vec_num = c('", paste(vec_num, collapse = "', '"), "')\n\n")
} else {
  out.vec_num <- paste0("vec_num = NULL\n\n")
}

# write vec_cat
if (!is.null(vec_cat)) {
  out.vec_cat <- paste0("vec_cat = c('", paste(vec_cat, collapse = "', '"), "')\n\n")
} else {
  out.vec_cat <- paste0("vec_cat = NULL\n\n")
}

# generate message
message_out <- paste0("ID_COL = '", ID_COL, "'\n",
                      "TARGET_COL = '", TARGET_COL, "'\n\n",
                      out.vec_num,
                      out.vec_cat, "\n\n")

# write message to file
write(message_out, file = "options.R")
rm(message_out, out.vec_cat, out.vec_num)
invisible(gc())
```

# Save Dataset

```{r}
if (!dir.exists("./export/")) {
  dir.create("./export/")
}

data.table::fwrite(x = dataset,
                   file = "./export/dataset.csv",
                   row.names = F,
                   sep = ",",
                   dec = ".")
invisible(gc())
save.image()
```
